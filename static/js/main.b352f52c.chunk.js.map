{"version":3,"sources":["utils/index.ts","utils/http.ts","utils/use-async.ts","components/error-boundary.tsx","App.tsx","reportWebVitals.ts","context/index.tsx","index.tsx","auth-provider.ts","components/lib.tsx","context/auth-context.tsx"],"names":["cleanObject","object","result","Object","keys","forEach","key","value","undefined","isVoid","useMount","callback","useEffect","useDebounce","delay","useState","debouncedValue","setDebouncedValue","timeout","setTimeout","clearTimeout","useDocumentTitle","title","keepOnMount","oldTitle","useRef","document","current","resetRoute","window","location","href","origin","subset","obj","filteredEntries","entries","filter","includes","fromEntries","useMountRef","mountRef","apiUrl","process","http","endpoint","a","data","token","headers","customConfig","config","method","Authorization","toUpperCase","qs","stringify","body","JSON","fetch","then","response","status","auth","reload","Promise","reject","message","json","ok","useHttp","user","useAuth","useCallback","defaultInitialState","stat","error","defaultConfig","throwOnError","useAsync","initialState","initialConfig","useReducer","state","action","safeDispatch","dispatch","useSafeDispatch","retry","setRetry","setData","setError","run","promise","runConfig","Error","catch","console","log","isIdle","isLoading","isError","isSuccess","ErrorBoundary","this","props","fallbackRender","children","React","Component","AuthenticatedApp","lazy","UnauthenticatedApp","App","className","FullPageErrorFallback","Suspense","fallback","reportWebVitals","onPerfEntry","Function","getCLS","getFID","getFCP","getLCP","getTTFB","AppProviders","QueryClientProvider","client","QueryClient","loadServer","ReactDOM","render","StrictMode","getElementById","localStorageKey","getToken","localStorage","getItem","handleUserResponse","setItem","login","register","logout","removeItem","Row","styled","div","between","marginBottom","gap","FullPage","FullPageLoading","size","ErrorBox","ButtonNoPadding","Button","Text","type","ScreenContainer","bootstrapUser","AuthContext","createContext","displayName","AuthProvider","setUser","queryClient","useQueryClient","Provider","form","clear","context","useContext"],"mappings":"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","file":"static/js/main.b352f52c.chunk.js","sourcesContent":["import { useEffect, useRef, useState } from 'react';\r\n\r\nexport const isFalsy = (value: unknown) => (value === 0 ? false : !value);\r\nexport const isVoid = (value: unknown) =>\r\n  value === undefined || value === null || value === '';\r\n\r\nexport const cleanObject = (object: { [key: string]: unknown }) => {\r\n  const result = { ...object };\r\n  Object.keys(result).forEach((key) => {\r\n    const value = result[key];\r\n    if (isVoid(value)) {\r\n      delete result[key];\r\n    }\r\n  });\r\n  return result;\r\n};\r\n\r\nexport const useMount = (callback: () => void) => {\r\n  useEffect(() => {\r\n    callback();\r\n  }, [callback]);\r\n};\r\n\r\nexport const useDebounce = <V>(value: V, delay?: number) => {\r\n  const [debouncedValue, setDebouncedValue] = useState(value);\r\n\r\n  useEffect(() => {\r\n    // 每次在value变化以后，设置一个定时器\r\n    const timeout = setTimeout(() => setDebouncedValue(value), delay);\r\n    // 每次在上一个useEffect处理完以后再运行\r\n    return () => clearTimeout(timeout);\r\n  }, [value, delay]);\r\n\r\n  return debouncedValue;\r\n};\r\n\r\nexport const useArray = <T>(initialArray: T[]) => {\r\n  const [value, setValue] = useState(initialArray);\r\n  return {\r\n    value,\r\n    setValue,\r\n    add: (item: T) => setValue([...value, item]),\r\n    clear: () => setValue([]),\r\n    removeIndex: (index: number) => {\r\n      const copy = [...value];\r\n      copy.splice(index, 1);\r\n      setValue(copy);\r\n    },\r\n  };\r\n};\r\n\r\nexport const useDocumentTitle = (\r\n  title: string,\r\n  keepOnMount: boolean = true\r\n) => {\r\n  const oldTitle = useRef(document.title).current;\r\n\r\n  useEffect(() => {\r\n    document.title = title;\r\n  }, [title]);\r\n\r\n  useEffect(() => {\r\n    return () => {\r\n      if (!keepOnMount) {\r\n        document.title = oldTitle;\r\n      }\r\n    };\r\n  }, [keepOnMount, oldTitle]);\r\n};\r\n\r\nexport const resetRoute = () => (window.location.href = window.location.origin);\r\n\r\n/**\r\n * 传入一个对象，和键集合，返回对应的对象中的键值对\r\n * @param obj\r\n * @param keys\r\n */\r\nexport const subset = <\r\n  O extends { [key in string]: unknown },\r\n  K extends keyof O\r\n>(\r\n  obj: O,\r\n  keys: K[]\r\n) => {\r\n  const filteredEntries = Object.entries(obj).filter(([key]) =>\r\n    keys.includes(key as K)\r\n  );\r\n  return Object.fromEntries(filteredEntries) as Pick<O, K>;\r\n};\r\n\r\n/**\r\n * 返回组件的挂载状态，如果还没挂载或者已经卸载，返回false，反之返回true\r\n */\r\nexport const useMountRef = () => {\r\n  const mountRef = useRef(false);\r\n  useEffect(() => {\r\n    mountRef.current = true;\r\n    return () => {\r\n      mountRef.current = false;\r\n    };\r\n  });\r\n\r\n  return mountRef;\r\n};\r\n","import qs from \"qs\";\r\nimport * as auth from \"auth-provider\";\r\nimport { useAuth } from \"context/auth-context\";\r\nimport { useCallback } from \"react\";\r\n\r\nconst apiUrl = process.env.REACT_APP_API_URL;\r\n\r\ninterface Config extends RequestInit {\r\n    token?: string,\r\n    data?: object\r\n}\r\n\r\n// endpoint:请求路径\r\nexport const http = async (endpoint: string, { data, token, headers, ...customConfig }: Config = {}) => {\r\n    const config = {\r\n        method: 'GET',\r\n        headers: {\r\n            Authorization: token ? `Bearer ${token}` : '',\r\n            'Content-Type': data ? 'application/json' : ''\r\n        },\r\n        ...customConfig\r\n    }\r\n    if (config.method.toUpperCase() === 'GET') {\r\n        endpoint += `?${qs.stringify(data)}`\r\n    } else {\r\n        config.body = JSON.stringify(data || {})\r\n    }\r\n    return window.fetch(`${apiUrl}/${endpoint}`, config).then(async response => {\r\n        if (response.status === 401) {\r\n            await auth.logout()\r\n            window.location.reload()\r\n            return Promise.reject({ message: '请重新登录' })\r\n        } else {\r\n            const data = await response.json()\r\n            if (response.ok) {\r\n                return data\r\n            } else {\r\n                return Promise.reject(data)\r\n            }\r\n        }\r\n    })\r\n}\r\n\r\n// 以http方法为基础的自动携带token的方法\r\nexport const useHttp = () => {\r\n    const { user } = useAuth();\r\n    // Parameters:TS Utility Types\r\n    return useCallback((...[endpoint, config]: Parameters<typeof http>) => http(endpoint, { ...config, token: user?.token }), [user?.token])\r\n}\r\n","import { useMountRef } from './index';\r\nimport { useCallback, useReducer, useState } from 'react';\r\ninterface State<D> {\r\n    error: null | Error,\r\n    data: D | null,\r\n    stat: 'idle' | 'loading' | 'error' | 'success'\r\n}\r\n\r\nconst defaultInitialState: State<null> = {\r\n    stat: 'idle',\r\n    data: null,\r\n    error: null\r\n}\r\n\r\nconst defaultConfig = {\r\n    throwOnError: false\r\n}\r\n\r\nconst useSafeDispatch = <T>(dispatch: (...args: T[]) => void) => {\r\n    const mountRef = useMountRef()\r\n\r\n    return useCallback((...args: T[]) => (mountRef.current ? dispatch(...args) : void 0), [dispatch, mountRef])\r\n}\r\n\r\nexport const useAsync = <D>(initialState?: State<D>, initialConfig?: typeof defaultConfig) => {\r\n    const config = { ...defaultConfig, ...initialConfig }\r\n    const [state, dispatch] = useReducer(\r\n        (state: State<D>, action: Partial<State<D>>) => ({ ...state, ...action }),\r\n        {\r\n            ...defaultInitialState,\r\n            ...initialState\r\n        }\r\n    )\r\n\r\n    const safeDispatch = useSafeDispatch(dispatch)\r\n\r\n    const [retry, setRetry] = useState(() => () => { })\r\n\r\n    const setData = useCallback((data: D) => safeDispatch({\r\n        data,\r\n        stat: 'success',\r\n        error: null\r\n    }), [safeDispatch])\r\n\r\n    const setError = useCallback((error: Error) => safeDispatch({\r\n        error,\r\n        stat: 'error',\r\n        data: null\r\n    }), [safeDispatch])\r\n\r\n    // 触发异步\r\n    const run = useCallback(\r\n        (promise: Promise<D>, runConfig?: { retry: () => Promise<D> }) => {\r\n            if (!promise || !promise.then) {\r\n                throw new Error('请传入Promise类型数据')\r\n            }\r\n            setRetry(() => () => {\r\n                if (runConfig?.retry) {\r\n                    run(runConfig?.retry(), runConfig)\r\n                }\r\n\r\n            })\r\n            safeDispatch({ stat: 'loading' })\r\n            return promise.then(data => {\r\n\r\n                setData(data)\r\n                return data\r\n\r\n\r\n            }).catch(error => {\r\n                // 这里的catch会消化异常，如果不主动抛出，就不能在外面接收到异常\r\n                setError(error)\r\n                if (config.throwOnError) {\r\n                    console.log(config.throwOnError)\r\n                    return Promise.reject(error)\r\n                }\r\n\r\n                return error\r\n            })\r\n\r\n        }, [config.throwOnError, safeDispatch, setData, setError])\r\n\r\n\r\n\r\n    return {\r\n        isIdle: state.stat === 'idle',\r\n        isLoading: state.stat === 'loading',\r\n        isError: state.stat === 'error',\r\n        isSuccess: state.stat === 'success',\r\n        // retry调用时重新执行一次run\r\n        retry,\r\n        run,\r\n        setData,\r\n        setError,\r\n        ...state\r\n    }\r\n}","import React from \"react\";\r\n\r\n\r\ntype FallbackRender = (props: { error: Error | null }) => React.ReactElement\r\nexport class ErrorBoundary extends React.Component<React.PropsWithChildren<{ fallbackRender: FallbackRender }>, { error: Error | null }>{\r\n    state = { error: null }\r\n\r\n    // 当子组件抛出异常，这里会接收到并且调用\r\n    static getDerivedStateFromError(error: Error) {\r\n        return error\r\n    }\r\n\r\n    render() {\r\n        const { error } = this.state\r\n        const { fallbackRender, children } = this.props\r\n        if (error) {\r\n            return fallbackRender({ error })\r\n        }\r\n        return children\r\n    }\r\n}","import { ErrorBoundary } from 'components/error-boundary';\nimport { FullPageErrorFallback, FullPageLoading } from 'components/lib';\nimport { useAuth } from 'context/auth-context';\nimport React from 'react';\nimport './App.css';\n\nconst AuthenticatedApp = React.lazy(() => import('authenticated-app'));\nconst UnauthenticatedApp = React.lazy(() => import('unauthenticated-app'));\n\nfunction App() {\n  const { user } = useAuth();\n  return (\n    <div className=\"App\">\n      <ErrorBoundary fallbackRender={FullPageErrorFallback}>\n        <React.Suspense fallback={<FullPageLoading />}>\n          {user ? <AuthenticatedApp /> : <UnauthenticatedApp />}\n        </React.Suspense>\n      </ErrorBoundary>\n    </div>\n  );\n}\n\nexport default App;\n","import { ReportHandler } from 'web-vitals';\r\n\r\nconst reportWebVitals = (onPerfEntry?: ReportHandler) => {\r\n  if (onPerfEntry && onPerfEntry instanceof Function) {\r\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\r\n      getCLS(onPerfEntry);\r\n      getFID(onPerfEntry);\r\n      getFCP(onPerfEntry);\r\n      getLCP(onPerfEntry);\r\n      getTTFB(onPerfEntry);\r\n    });\r\n  }\r\n};\r\n\r\nexport default reportWebVitals;\r\n","import { ReactNode } from \"react\";\r\nimport { QueryClient, QueryClientProvider } from \"react-query\";\r\nimport { AuthProvider } from \"./auth-context\";\r\n\r\nexport const AppProviders = ({ children }: { children: ReactNode }) => {\r\n    return (\r\n        <QueryClientProvider client={new QueryClient()}>\r\n            <AuthProvider>{children}</AuthProvider>\r\n        </QueryClientProvider>\r\n    )\r\n}","import './wdyr'\r\nimport React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport App from './App';\r\nimport reportWebVitals from './reportWebVitals';\r\nimport { loadServer, DevTools } from 'jira-dev-tool';\r\n// 务必在jira-dev-tool后面引入，覆盖其的antd样式\r\nimport 'antd/dist/antd.less';\r\nimport { AppProviders } from 'context';\r\n\r\nloadServer(() => ReactDOM.render(\r\n  <React.StrictMode>\r\n    <AppProviders>\r\n      <DevTools />\r\n      <App />\r\n    </AppProviders>\r\n  </React.StrictMode>,\r\n  document.getElementById('root')\r\n))\r\n\r\n// If you want to start measuring performance in your app, pass a function\r\n// to log results (for example: reportWebVitals(console.log))\r\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\r\nreportWebVitals();\r\n","// 在真实环境中，如果使用firebase这种第三方auth服务的话，本文件不需要开发者开发\n\nimport { User } from 'types/user';\n\nconst apiUrl = process.env.REACT_APP_API_URL;\n\nconst localStorageKey = '__auth_provider_token__';\n\nexport const getToken = () => window.localStorage.getItem(localStorageKey);\n\nexport const handleUserResponse = ({ user }: { user: User }) => {\n  window.localStorage.setItem(localStorageKey, user.token || '');\n  return user;\n};\n\nexport const login = (data: { username: string; password: string }) => {\n  return fetch(`${apiUrl}/login`, {\n    method: 'POST',\n    headers: {\n      'Content-Type': 'application/json',\n    },\n    body: JSON.stringify(data),\n  }).then(async (response) => {\n    if (response.ok) {\n      return handleUserResponse(await response.json());\n    } else {\n      return Promise.reject(await response.json());\n    }\n  });\n};\n\nexport const register = (data: { username: string; password: string }) => {\n  return fetch(`${apiUrl}/register`, {\n    method: 'POST',\n    headers: {\n      'Content-Type': 'application/json',\n    },\n    body: JSON.stringify(data),\n  }).then(async (response) => {\n    if (response.ok) {\n      return handleUserResponse(await response.json());\n    } else {\n      return Promise.reject(await response.json());\n    }\n  });\n};\n\nexport const logout = async () =>\n  window.localStorage.removeItem(localStorageKey);\n","import styled from '@emotion/styled';\nimport { Button, Spin, Typography } from 'antd';\nimport { DevTools } from 'jira-dev-tool';\n\nexport const Row = styled.div<{\n  gap?: number | boolean;\n  between?: boolean;\n  marginBottom?: number;\n}>`\n  display: flex;\n  align-items: center;\n  justify-content: ${(props) => (props.between ? 'space-between' : undefined)};\n  margin-bottom: ${(props) => props.marginBottom + 'rem'};\n  > * {\n    margin-top: 0 !important;\n    margin-bottom: 0 !important;\n    margin-right: ${(props) =>\n      typeof props.gap === 'number'\n        ? props.gap + 'rem'\n        : props.gap\n        ? '2rem'\n        : undefined};\n  }\n`;\n\nconst FullPage = styled.div`\n  height: 100vh;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n`;\n\nexport const FullPageLoading = () => (\n  <FullPage>\n    <Spin size=\"large\" />\n  </FullPage>\n);\nexport const FullPageErrorFallback = ({ error }: { error: Error | null }) => (\n  <FullPage>\n    <DevTools />\n    <ErrorBox error={error} />\n  </FullPage>\n);\n\nexport const ButtonNoPadding = styled(Button)`\n  padding: 0;\n`;\n\n// 类型守卫\nconst isError = (value: any): value is Error => value?.message;\n\nexport const ErrorBox = ({ error }: { error: unknown }) => {\n  if (isError(error)) {\n    return <Typography.Text type=\"danger\">{error.message}</Typography.Text>;\n  }\n  return null;\n};\n\nexport const ScreenContainer = styled.div`\n  padding: 3.2rem;\n  width: 100%;\n  display: flex;\n  flex-direction: column;\n`;\n","import React, { ReactNode, useCallback } from 'react';\nimport * as auth from 'auth-provider';\nimport { http } from 'utils/http';\nimport { useMount } from 'utils';\nimport { useAsync } from 'utils/use-async';\nimport { FullPageErrorFallback, FullPageLoading } from 'components/lib';\nimport { useQueryClient } from 'react-query';\nimport { User } from 'types/user';\n\ninterface AuthForm {\n  username: string;\n  password: string;\n}\n\n// 保持登录状态\nconst bootstrapUser = async () => {\n  let user = null;\n  const token = auth.getToken();\n  if (token) {\n    const data = await http('me', { token });\n    user = data.user;\n  }\n  return user;\n};\n\nconst AuthContext = React.createContext<\n  | {\n      user: User | null;\n      register: (form: AuthForm) => Promise<void>;\n      login: (form: AuthForm) => Promise<void>;\n      logout: () => Promise<void>;\n    }\n  | undefined\n>(undefined);\nAuthContext.displayName = 'AuthContext';\n\nexport const AuthProvider = ({ children }: { children: ReactNode }) => {\n  const {\n    data: user,\n    error,\n    isLoading,\n    isIdle,\n    isError,\n    run,\n    setData: setUser,\n  } = useAsync<User | null>();\n\n  const queryClient = useQueryClient();\n\n  const login = (form: AuthForm) => auth.login(form).then(setUser); // setUser等价于user=>setUser(user)\n\n  const register = (form: AuthForm) => auth.register(form).then(setUser);\n\n  const logout = () =>\n    auth.logout().then(() => {\n      setUser(null);\n      queryClient.clear();\n    });\n\n  useMount(\n    useCallback(() => {\n      run(bootstrapUser());\n    }, [run])\n  );\n\n  if (isIdle || isLoading) {\n    return <FullPageLoading />;\n  }\n\n  if (isError) {\n    return <FullPageErrorFallback error={error} />;\n  }\n\n  return (\n    <AuthContext.Provider\n      children={children}\n      value={{ user, register, login, logout }}\n    />\n  );\n};\n\nexport const useAuth = () => {\n  const context = React.useContext(AuthContext);\n  if (!context) {\n    throw new Error('useAuth必须在AuthProvider中使用');\n  }\n  return context;\n};\n"],"sourceRoot":""}